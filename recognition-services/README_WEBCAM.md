# üìπ Servi√ßo de Reconhecimento Facial - WEBCAM

Servi√ßo Python para reconhecimento facial em tempo real usando a **webcam do PC**.

## üöÄ Como usar

### 1. Instalar depend√™ncias

```bash
cd recognition-services
pip install -r requirements.txt
```

Se n√£o tiver `requirements.txt`, instale manualmente:

```bash
pip install opencv-python face_recognition pillow requests python-dotenv numpy
```

### 2. Configurar vari√°veis de ambiente

Copie o arquivo de exemplo:

```bash
copy .env.example .env
```

Edite o arquivo `.env` e configure:

```env
API_BASE=http://localhost:3001
WEBCAM_INDEX=0
CLASSROOM_CODE=3AT.I
```

### 3. Executar o servi√ßo

```bash
python reco_webcam_service.py
```

## ‚öôÔ∏è Configura√ß√µes importantes

### `WEBCAM_INDEX`

- `0` = Webcam padr√£o (integrada do notebook)
- `1` = Segunda c√¢mera (USB externa)
- Se n√£o funcionar, tente mudar o valor

### `FRAME_SAMPLER_FPS`

- `1` = Processa 1 frame por segundo (menos CPU)
- `2` = Processa 2 frames por segundo (**recomendado**)
- `5` = Processa 5 frames por segundo (mais r√°pido, usa mais CPU)

### `MATCH_TOLERANCE`

- `0.4` = Muito exigente (menos erros, mas pode n√£o reconhecer)
- `0.5` = **Recomendado** (balanceado)
- `0.6` = Mais permissivo (detecta mais f√°cil, mas pode ter falsos positivos)

### `SHOW_VIDEO`

- `true` = Mostra janela com v√≠deo da webcam (**recomendado para testes**)
- `false` = Roda em background sem interface (para produ√ß√£o)

## üìä Como funciona

1. **Carrega rostos conhecidos** da API (`/api/known-faces`)
2. **Abre a webcam** do PC
3. **Processa frames** a cada X segundos (configur√°vel)
4. **Detecta rostos** usando face_recognition (HOG)
5. **Compara** com rostos conhecidos
6. **Envia presen√ßa** para API quando reconhece algu√©m
7. **Debounce** de 60s (n√£o envia duplicatas do mesmo aluno)

## üéØ Requisitos

- Python 3.8+
- Webcam funcionando
- Backend rodando em `http://localhost:3001`
- Alunos cadastrados com fotos no sistema

## üêõ Troubleshooting

### Erro: "N√£o foi poss√≠vel abrir a webcam"

- Verifique se a webcam est√° conectada
- Tente mudar `WEBCAM_INDEX=0` para `1` ou `2`
- Feche outros programas que usam a webcam (Zoom, Teams, etc.)

### Erro: "Nenhum rosto conhecido carregado"

- Verifique se o backend est√° rodando
- Verifique se h√° alunos cadastrados com fotos
- Confirme a URL da API no `.env`

### Reconhecimento n√£o funciona

- Aumente `MATCH_TOLERANCE` (experimente 0.6)
- Melhore a ilumina√ß√£o
- Certifique-se que as fotos cadastradas s√£o boas (rostos frontais, boa qualidade)

## üîë Comandos √∫teis

**Parar o servi√ßo:**

- Pressione `Ctrl+C` no terminal
- Ou pressione `q` na janela de v√≠deo

**Ver logs em tempo real:**
Os logs aparecem no terminal automaticamente.

## üì¶ Diferen√ßas entre os servi√ßos

| Servi√ßo                  | Fonte              | Quando usar                              |
| ------------------------ | ------------------ | ---------------------------------------- |
| `reco_webcam_service.py` | **Webcam do PC**   | ‚úÖ **Use este!** (ESP32 n√£o est√° pronto) |
| `reco_stream_service.py` | Stream MJPEG ESP32 | Quando ESP32 estiver pronto              |
| `reco_service.py`        | Snapshots HTTP     | Debug/testes                             |

## ‚úÖ Checklist antes de usar

- [ ] Backend rodando (`npm run dev` na pasta `backend`)
- [ ] Alunos cadastrados com fotos
- [ ] Arquivo `.env` configurado
- [ ] Depend√™ncias instaladas (`pip install ...`)
- [ ] Webcam funcionando
- [ ] Nenhum outro programa usando a webcam

## üé• Interface visual

Se `SHOW_VIDEO=true`, voc√™ ver√°:

- üü¢ **Caixa verde** = Aluno reconhecido (nome + confian√ßa)
- üî¥ **Caixa vermelha** = Rosto desconhecido
- üìä **Informa√ß√µes no topo** = Rostos conhecidos, FPS, sala

Pressione **`q`** para sair.
